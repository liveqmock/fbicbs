<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cbs.repository.account.other.dao.ActtvcMapper">
    <resultMap id="BaseResultMap" type="cbs.repository.account.other.model.Acttvc">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Nov 21 21:36:06 CST 2010.
        -->
        <result column="ORGIDT" jdbcType="VARCHAR" property="orgidt"/>
        <result column="TLRNUM" jdbcType="VARCHAR" property="tlrnum"/>
        <result column="VCHSET" jdbcType="DECIMAL" property="vchset"/>
        <result column="SETSEQ" jdbcType="DECIMAL" property="setseq"/>
        <result column="CUSIDT" jdbcType="VARCHAR" property="cusidt"/>
        <result column="APCODE" jdbcType="VARCHAR" property="apcode"/>
        <result column="CURCDE" jdbcType="VARCHAR" property="curcde"/>
        <result column="PRDCDE" jdbcType="VARCHAR" property="prdcde"/>
        <result column="TXNAMT" jdbcType="DECIMAL" property="txnamt"/>
        <result column="VALDAT" jdbcType="VARCHAR" property="valdat"/>
        <result column="RVSLBL" jdbcType="VARCHAR" property="rvslbl"/>
        <result column="ANACDE" jdbcType="VARCHAR" property="anacde"/>
        <result column="FURINF" jdbcType="VARCHAR" property="furinf"/>
        <result column="FXRATE" jdbcType="DECIMAL" property="fxrate"/>
        <result column="SECCCY" jdbcType="VARCHAR" property="secccy"/>
        <result column="SECAMT" jdbcType="DECIMAL" property="secamt"/>
        <result column="CORAPC" jdbcType="VARCHAR" property="corapc"/>
        <result column="VCHATT" jdbcType="DECIMAL" property="vchatt"/>
        <result column="VCHAUT" jdbcType="VARCHAR" property="vchaut"/>
        <result column="DEPNUM" jdbcType="VARCHAR" property="depnum"/>
        <result column="TXNBAK" jdbcType="VARCHAR" property="txnbak"/>
        <result column="ACTBAK" jdbcType="VARCHAR" property="actbak"/>
        <result column="CLRBAK" jdbcType="VARCHAR" property="clrbak"/>
        <result column="ERYDAT" jdbcType="VARCHAR" property="erydat"/>
        <result column="ERYTIM" jdbcType="VARCHAR" property="erytim"/>
        <result column="OUFCRE" jdbcType="VARCHAR" property="oufcre"/>
        <result column="VCHSTS" jdbcType="VARCHAR" property="vchsts"/>
        <result column="FXEFLG" jdbcType="VARCHAR" property="fxeflg"/>
        <result column="RECSTS" jdbcType="VARCHAR" property="recsts"/>
        <result column="ERYTYP" jdbcType="VARCHAR" property="erytyp"/>
        <result column="REGNUM" jdbcType="VARCHAR" property="regnum"/>
    </resultMap>
    <sql id="Example_Where_Clause">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Nov 21 21:36:06 CST 2010.
        -->
        <where>
            <foreach collection="oredCriteria" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" prefixOverrides="and" suffix=")">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach close=")" collection="criterion.value" item="listItem" open="("
                                             separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>
    <sql id="Update_By_Example_Where_Clause">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Nov 21 21:36:06 CST 2010.
        -->
        <where>
            <foreach collection="example.oredCriteria" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" prefixOverrides="and" suffix=")">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach close=")" collection="criterion.value" item="listItem" open="("
                                             separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Nov 21 21:36:06 CST 2010.
        -->
        ORGIDT, TLRNUM, VCHSET, SETSEQ, CUSIDT, APCODE, CURCDE, PRDCDE, TXNAMT, VALDAT, RVSLBL,
        ANACDE, FURINF, FXRATE, SECCCY, SECAMT, CORAPC, VCHATT, VCHAUT, DEPNUM, TXNBAK, ACTBAK,
        CLRBAK, ERYDAT, ERYTIM, OUFCRE, VCHSTS, FXEFLG, RECSTS, ERYTYP, REGNUM
    </sql>
    <select id="selectByExample" parameterType="cbs.repository.account.other.model.ActtvcExample"
            resultMap="BaseResultMap">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Nov 21 21:36:06 CST 2010.
        -->
        select
        <if test="distinct">
            distinct
        </if>
        <include refid="Base_Column_List"/>
        from ACTTVC
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
        <if test="orderByClause != null">
            order by ${orderByClause}
        </if>
    </select>
    <delete id="deleteByExample" parameterType="cbs.repository.account.other.model.ActtvcExample">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Nov 21 21:36:06 CST 2010.
        -->
        delete from ACTTVC
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </delete>
    <insert id="insert" parameterType="cbs.repository.account.other.model.Acttvc">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Nov 21 21:36:06 CST 2010.
        -->
        insert into ACTTVC (ORGIDT, TLRNUM, VCHSET,
        SETSEQ, CUSIDT, APCODE,
        CURCDE, PRDCDE, TXNAMT,
        VALDAT, RVSLBL, ANACDE,
        FURINF, FXRATE, SECCCY,
        SECAMT, CORAPC, VCHATT,
        VCHAUT, DEPNUM, TXNBAK,
        ACTBAK, CLRBAK, ERYDAT,
        ERYTIM, OUFCRE, VCHSTS,
        FXEFLG, RECSTS, ERYTYP,
        REGNUM)
        values (#{orgidt,jdbcType=VARCHAR}, #{tlrnum,jdbcType=VARCHAR}, #{vchset,jdbcType=DECIMAL},
        #{setseq,jdbcType=DECIMAL}, #{cusidt,jdbcType=VARCHAR}, #{apcode,jdbcType=VARCHAR},
        #{curcde,jdbcType=VARCHAR}, #{prdcde,jdbcType=VARCHAR}, #{txnamt,jdbcType=DECIMAL},
        #{valdat,jdbcType=VARCHAR}, #{rvslbl,jdbcType=VARCHAR}, #{anacde,jdbcType=VARCHAR},
        #{furinf,jdbcType=VARCHAR}, #{fxrate,jdbcType=DECIMAL}, #{secccy,jdbcType=VARCHAR},
        #{secamt,jdbcType=DECIMAL}, #{corapc,jdbcType=VARCHAR}, #{vchatt,jdbcType=DECIMAL},
        #{vchaut,jdbcType=VARCHAR}, #{depnum,jdbcType=VARCHAR}, #{txnbak,jdbcType=VARCHAR},
        #{actbak,jdbcType=VARCHAR}, #{clrbak,jdbcType=VARCHAR}, #{erydat,jdbcType=VARCHAR},
        #{erytim,jdbcType=VARCHAR}, #{oufcre,jdbcType=VARCHAR}, #{vchsts,jdbcType=VARCHAR},
        #{fxeflg,jdbcType=VARCHAR}, #{recsts,jdbcType=VARCHAR}, #{erytyp,jdbcType=VARCHAR},
        #{regnum,jdbcType=VARCHAR})
    </insert>
    <insert id="insertSelective" parameterType="cbs.repository.account.other.model.Acttvc">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Nov 21 21:36:06 CST 2010.
        -->
        insert into ACTTVC
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="orgidt != null">
                ORGIDT,
            </if>
            <if test="tlrnum != null">
                TLRNUM,
            </if>
            <if test="vchset != null">
                VCHSET,
            </if>
            <if test="setseq != null">
                SETSEQ,
            </if>
            <if test="cusidt != null">
                CUSIDT,
            </if>
            <if test="apcode != null">
                APCODE,
            </if>
            <if test="curcde != null">
                CURCDE,
            </if>
            <if test="prdcde != null">
                PRDCDE,
            </if>
            <if test="txnamt != null">
                TXNAMT,
            </if>
            <if test="valdat != null">
                VALDAT,
            </if>
            <if test="rvslbl != null">
                RVSLBL,
            </if>
            <if test="anacde != null">
                ANACDE,
            </if>
            <if test="furinf != null">
                FURINF,
            </if>
            <if test="fxrate != null">
                FXRATE,
            </if>
            <if test="secccy != null">
                SECCCY,
            </if>
            <if test="secamt != null">
                SECAMT,
            </if>
            <if test="corapc != null">
                CORAPC,
            </if>
            <if test="vchatt != null">
                VCHATT,
            </if>
            <if test="vchaut != null">
                VCHAUT,
            </if>
            <if test="depnum != null">
                DEPNUM,
            </if>
            <if test="txnbak != null">
                TXNBAK,
            </if>
            <if test="actbak != null">
                ACTBAK,
            </if>
            <if test="clrbak != null">
                CLRBAK,
            </if>
            <if test="erydat != null">
                ERYDAT,
            </if>
            <if test="erytim != null">
                ERYTIM,
            </if>
            <if test="oufcre != null">
                OUFCRE,
            </if>
            <if test="vchsts != null">
                VCHSTS,
            </if>
            <if test="fxeflg != null">
                FXEFLG,
            </if>
            <if test="recsts != null">
                RECSTS,
            </if>
            <if test="erytyp != null">
                ERYTYP,
            </if>
            <if test="regnum != null">
                REGNUM,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="orgidt != null">
                #{orgidt,jdbcType=VARCHAR},
            </if>
            <if test="tlrnum != null">
                #{tlrnum,jdbcType=VARCHAR},
            </if>
            <if test="vchset != null">
                #{vchset,jdbcType=DECIMAL},
            </if>
            <if test="setseq != null">
                #{setseq,jdbcType=DECIMAL},
            </if>
            <if test="cusidt != null">
                #{cusidt,jdbcType=VARCHAR},
            </if>
            <if test="apcode != null">
                #{apcode,jdbcType=VARCHAR},
            </if>
            <if test="curcde != null">
                #{curcde,jdbcType=VARCHAR},
            </if>
            <if test="prdcde != null">
                #{prdcde,jdbcType=VARCHAR},
            </if>
            <if test="txnamt != null">
                #{txnamt,jdbcType=DECIMAL},
            </if>
            <if test="valdat != null">
                #{valdat,jdbcType=VARCHAR},
            </if>
            <if test="rvslbl != null">
                #{rvslbl,jdbcType=VARCHAR},
            </if>
            <if test="anacde != null">
                #{anacde,jdbcType=VARCHAR},
            </if>
            <if test="furinf != null">
                #{furinf,jdbcType=VARCHAR},
            </if>
            <if test="fxrate != null">
                #{fxrate,jdbcType=DECIMAL},
            </if>
            <if test="secccy != null">
                #{secccy,jdbcType=VARCHAR},
            </if>
            <if test="secamt != null">
                #{secamt,jdbcType=DECIMAL},
            </if>
            <if test="corapc != null">
                #{corapc,jdbcType=VARCHAR},
            </if>
            <if test="vchatt != null">
                #{vchatt,jdbcType=DECIMAL},
            </if>
            <if test="vchaut != null">
                #{vchaut,jdbcType=VARCHAR},
            </if>
            <if test="depnum != null">
                #{depnum,jdbcType=VARCHAR},
            </if>
            <if test="txnbak != null">
                #{txnbak,jdbcType=VARCHAR},
            </if>
            <if test="actbak != null">
                #{actbak,jdbcType=VARCHAR},
            </if>
            <if test="clrbak != null">
                #{clrbak,jdbcType=VARCHAR},
            </if>
            <if test="erydat != null">
                #{erydat,jdbcType=VARCHAR},
            </if>
            <if test="erytim != null">
                #{erytim,jdbcType=VARCHAR},
            </if>
            <if test="oufcre != null">
                #{oufcre,jdbcType=VARCHAR},
            </if>
            <if test="vchsts != null">
                #{vchsts,jdbcType=VARCHAR},
            </if>
            <if test="fxeflg != null">
                #{fxeflg,jdbcType=VARCHAR},
            </if>
            <if test="recsts != null">
                #{recsts,jdbcType=VARCHAR},
            </if>
            <if test="erytyp != null">
                #{erytyp,jdbcType=VARCHAR},
            </if>
            <if test="regnum != null">
                #{regnum,jdbcType=VARCHAR},
            </if>
        </trim>
    </insert>
    <select id="countByExample" parameterType="cbs.repository.account.other.model.ActtvcExample"
            resultType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Nov 21 21:36:06 CST 2010.
        -->
        select count(*) from ACTTVC
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </select>
    <update id="updateByExampleSelective" parameterType="map">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Nov 21 21:36:06 CST 2010.
        -->
        update ACTTVC
        <set>
            <if test="record.orgidt != null">
                ORGIDT = #{record.orgidt,jdbcType=VARCHAR},
            </if>
            <if test="record.tlrnum != null">
                TLRNUM = #{record.tlrnum,jdbcType=VARCHAR},
            </if>
            <if test="record.vchset != null">
                VCHSET = #{record.vchset,jdbcType=DECIMAL},
            </if>
            <if test="record.setseq != null">
                SETSEQ = #{record.setseq,jdbcType=DECIMAL},
            </if>
            <if test="record.cusidt != null">
                CUSIDT = #{record.cusidt,jdbcType=VARCHAR},
            </if>
            <if test="record.apcode != null">
                APCODE = #{record.apcode,jdbcType=VARCHAR},
            </if>
            <if test="record.curcde != null">
                CURCDE = #{record.curcde,jdbcType=VARCHAR},
            </if>
            <if test="record.prdcde != null">
                PRDCDE = #{record.prdcde,jdbcType=VARCHAR},
            </if>
            <if test="record.txnamt != null">
                TXNAMT = #{record.txnamt,jdbcType=DECIMAL},
            </if>
            <if test="record.valdat != null">
                VALDAT = #{record.valdat,jdbcType=VARCHAR},
            </if>
            <if test="record.rvslbl != null">
                RVSLBL = #{record.rvslbl,jdbcType=VARCHAR},
            </if>
            <if test="record.anacde != null">
                ANACDE = #{record.anacde,jdbcType=VARCHAR},
            </if>
            <if test="record.furinf != null">
                FURINF = #{record.furinf,jdbcType=VARCHAR},
            </if>
            <if test="record.fxrate != null">
                FXRATE = #{record.fxrate,jdbcType=DECIMAL},
            </if>
            <if test="record.secccy != null">
                SECCCY = #{record.secccy,jdbcType=VARCHAR},
            </if>
            <if test="record.secamt != null">
                SECAMT = #{record.secamt,jdbcType=DECIMAL},
            </if>
            <if test="record.corapc != null">
                CORAPC = #{record.corapc,jdbcType=VARCHAR},
            </if>
            <if test="record.vchatt != null">
                VCHATT = #{record.vchatt,jdbcType=DECIMAL},
            </if>
            <if test="record.vchaut != null">
                VCHAUT = #{record.vchaut,jdbcType=VARCHAR},
            </if>
            <if test="record.depnum != null">
                DEPNUM = #{record.depnum,jdbcType=VARCHAR},
            </if>
            <if test="record.txnbak != null">
                TXNBAK = #{record.txnbak,jdbcType=VARCHAR},
            </if>
            <if test="record.actbak != null">
                ACTBAK = #{record.actbak,jdbcType=VARCHAR},
            </if>
            <if test="record.clrbak != null">
                CLRBAK = #{record.clrbak,jdbcType=VARCHAR},
            </if>
            <if test="record.erydat != null">
                ERYDAT = #{record.erydat,jdbcType=VARCHAR},
            </if>
            <if test="record.erytim != null">
                ERYTIM = #{record.erytim,jdbcType=VARCHAR},
            </if>
            <if test="record.oufcre != null">
                OUFCRE = #{record.oufcre,jdbcType=VARCHAR},
            </if>
            <if test="record.vchsts != null">
                VCHSTS = #{record.vchsts,jdbcType=VARCHAR},
            </if>
            <if test="record.fxeflg != null">
                FXEFLG = #{record.fxeflg,jdbcType=VARCHAR},
            </if>
            <if test="record.recsts != null">
                RECSTS = #{record.recsts,jdbcType=VARCHAR},
            </if>
            <if test="record.erytyp != null">
                ERYTYP = #{record.erytyp,jdbcType=VARCHAR},
            </if>
            <if test="record.regnum != null">
                REGNUM = #{record.regnum,jdbcType=VARCHAR},
            </if>
        </set>
        <if test="_parameter != null">
            <include refid="Update_By_Example_Where_Clause"/>
        </if>
    </update>
    <update id="updateByExample" parameterType="map">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Nov 21 21:36:06 CST 2010.
        -->
        update ACTTVC
        set ORGIDT = #{record.orgidt,jdbcType=VARCHAR},
        TLRNUM = #{record.tlrnum,jdbcType=VARCHAR},
        VCHSET = #{record.vchset,jdbcType=DECIMAL},
        SETSEQ = #{record.setseq,jdbcType=DECIMAL},
        CUSIDT = #{record.cusidt,jdbcType=VARCHAR},
        APCODE = #{record.apcode,jdbcType=VARCHAR},
        CURCDE = #{record.curcde,jdbcType=VARCHAR},
        PRDCDE = #{record.prdcde,jdbcType=VARCHAR},
        TXNAMT = #{record.txnamt,jdbcType=DECIMAL},
        VALDAT = #{record.valdat,jdbcType=VARCHAR},
        RVSLBL = #{record.rvslbl,jdbcType=VARCHAR},
        ANACDE = #{record.anacde,jdbcType=VARCHAR},
        FURINF = #{record.furinf,jdbcType=VARCHAR},
        FXRATE = #{record.fxrate,jdbcType=DECIMAL},
        SECCCY = #{record.secccy,jdbcType=VARCHAR},
        SECAMT = #{record.secamt,jdbcType=DECIMAL},
        CORAPC = #{record.corapc,jdbcType=VARCHAR},
        VCHATT = #{record.vchatt,jdbcType=DECIMAL},
        VCHAUT = #{record.vchaut,jdbcType=VARCHAR},
        DEPNUM = #{record.depnum,jdbcType=VARCHAR},
        TXNBAK = #{record.txnbak,jdbcType=VARCHAR},
        ACTBAK = #{record.actbak,jdbcType=VARCHAR},
        CLRBAK = #{record.clrbak,jdbcType=VARCHAR},
        ERYDAT = #{record.erydat,jdbcType=VARCHAR},
        ERYTIM = #{record.erytim,jdbcType=VARCHAR},
        OUFCRE = #{record.oufcre,jdbcType=VARCHAR},
        VCHSTS = #{record.vchsts,jdbcType=VARCHAR},
        FXEFLG = #{record.fxeflg,jdbcType=VARCHAR},
        RECSTS = #{record.recsts,jdbcType=VARCHAR},
        ERYTYP = #{record.erytyp,jdbcType=VARCHAR},
        REGNUM = #{record.regnum,jdbcType=VARCHAR}
        <if test="_parameter != null">
            <include refid="Update_By_Example_Where_Clause"/>
        </if>
    </update>

    <!--zhanrui ??????????????? -->
    <select id="selectMaxSetseq" resultType="java.lang.Integer">
        select max(setseq) from acttvc where orgidt=#{orgidt} and tlrnum=#{tlrnum} and vchset=#{vchset}
    </select>

    <!--zhanrui ??????????????? -->
    <select id="countValidRecordOfVchset" resultType="java.lang.Integer">
        select count(*) from acttvc where orgidt=#{orgidt} and tlrnum=#{tlrnum} and vchset=#{vchset} and recsts=' '
    </select>
    <select id="countAllRecordOfVchset" resultType="java.lang.Integer">
        select count(*) from acttvc where orgidt=#{orgidt} and tlrnum=#{tlrnum} and vchset=#{vchset}
    </select>

    <select id="selectValidRecordByVchset" resultMap="BaseResultMap">
        select * from acttvc where orgidt=#{orgidt} and tlrnum=#{tlrnum} and vchset=#{vchset} and recsts=' ' order by setseq
    </select>
    <select id="selectAllRecordByVchset" resultMap="BaseResultMap">
        select * from acttvc where orgidt=#{orgidt} and tlrnum=#{tlrnum} and vchset=#{vchset}  order by setseq
    </select>
    <select id="selectAllRecordByVchsts" resultMap="BaseResultMap">
        select * from acttvc where orgidt=#{orgidt} and cusidt=#{cusidt} and apcode=#{apcode} and curcde=#{curcde} and vchsts='1' and recsts=' '
    </select>
    <select id="selectAllRecordByActnoAndVchset" resultMap="BaseResultMap">
        select * from acttvc where orgidt=#{orgidt} and cusidt=#{cusidt} and apcode=#{apcode} and curcde=#{curcde}
        and tlrnum=#{tlrnum} and vchset=#{vchset}  and vchsts='1' and recsts=' '
    </select>
    <!--zhanrui 注意 未对外币进行处理 -->
    <select id="selectTotalDebitAmt" resultType="java.lang.Long">
        <![CDATA[

        select (
                (select nvl(-sum(txnamt),0) from acttvc where orgidt=#{orgidt} and tlrnum=#{tlrnum} and  vchset=#{vchset} and txnamt < 0 and recsts = ' ' and  rvslbl<>'*')
                +
                (select nvl(sum(txnamt),0) from acttvc where orgidt=#{orgidt} and tlrnum=#{tlrnum} and  vchset=#{vchset} and txnamt > 0 and recsts = ' ' and rvslbl ='*')
            ) as txnamt from dual

        ]]>
    </select>
    <select id="selectTotalCreditAmt" resultType="java.lang.Long">
        <![CDATA[

        select (
                (select nvl(sum(txnamt),0) from acttvc where orgidt=#{orgidt} and tlrnum=#{tlrnum} and  vchset=#{vchset} and txnamt > 0 and recsts = ' ' and rvslbl<>'*')
                +
                (select nvl(-sum(txnamt),0) from acttvc where orgidt=#{orgidt} and tlrnum=#{tlrnum} and  vchset=#{vchset} and txnamt < 0 and recsts = ' ' and rvslbl='*')
            ) as txnamt from dual

        ]]>
    </select>

    <!--zhanrui ??? -->
    <select id="selectPagedRecords" resultMap="BaseResultMap">
        <![CDATA[

        select * from
        (
            select t.*,rownum rn from
                (select * from acttvc where orgidt=#{orgidt} and tlrnum=#{tlrnum} and  vchset=#{vchset} order by setseq) t
            where rownum < #{maxnum,jdbcType=DECIMAL}
        )
        where rn >= #{minnum,jdbcType=DECIMAL}

        ]]>
    </select>


    <!--View Layer Mapper-->
    <resultMap id="ViewResultMap" type="cbs.repository.account.ext.domain.BatchBookVO">
        <result column="ORGIDT" jdbcType="VARCHAR" property="orgidt"/>
        <result column="TLRNUM" jdbcType="VARCHAR" property="tlrnum"/>
        <result column="VCHSET" jdbcType="DECIMAL" property="vchset"/>
        <result column="SETSEQ" jdbcType="DECIMAL" property="setseq"/>

        <!--?????? -->
        <result column="ACTNO" jdbcType="VARCHAR" property="actno"/>

        <result column="TXNAMT" jdbcType="DECIMAL" property="txnamt"/>
        <result column="VALDAT" jdbcType="VARCHAR" property="valdat"/>
        <result column="RVSLBL" jdbcType="VARCHAR" property="rvslbl"/>
        <result column="ANACDE" jdbcType="VARCHAR" property="anacde"/>
        <result column="FURINF" jdbcType="VARCHAR" property="furinf"/>

        <result column="VCHATT" jdbcType="DECIMAL" property="vchatt"/>

        <result column="ACTNAM" jdbcType="VARCHAR" property="actnam"/>
    </resultMap>

    <!--????????????? -->
    <select id="selectMultiVchsetRecords" resultMap="ViewResultMap">
        <![CDATA[

        SELECT  A.VCHSET,A.SETSEQ,
                A.CUSIDT, A.APCODE, A.CURCDE,
                C.OLDACN AS ACTNO,
                A.RVSLBL AS TYPE,
                A.TXNAMT,
                A.VALDAT,A.ANACDE,A.FURINF,A.VCHATT,A.VCHSTS,A.RECSTS,
                B.ACTNAM
        FROM
           (SELECT ORGIDT, TLRNUM, VCHSET, SETSEQ,
                   CUSIDT, APCODE, CURCDE, PRDCDE,
                   TXNAMT, VALDAT, RVSLBL, ANACDE,
                   FURINF, FXRATE, SECCCY, SECAMT,
                   CORAPC, VCHATT, VCHAUT, DEPNUM,
                   TXNBAK, ACTBAK, CLRBAK, ERYDAT,
                   ERYTIM, OUFCRE, VCHSTS, FXEFLG,
                   RECSTS, ERYTYP
             FROM ACTTVC
            WHERE ORGIDT=#{orgidt}
              AND TLRNUM=#{tlrnum}
              AND ( VCHSET IN ( SELECT DISTINCT VCHSET
                                  FROM ACTTVC
                                 WHERE ORGIDT=#{orgidt}
                                   AND TLRNUM=#{tlrnum}
                                   AND RECSTS=' '
                                   AND VCHSTS='1' )  OR
                    VCHSET IN ( SELECT VCHSET
                                  FROM ACTTVC
                                 WHERE ORGIDT=#{orgidt}
                                   AND TLRNUM=#{tlrnum}
                                   AND RECSTS=' '
                                 GROUP BY VCHSET,CURCDE
          HAVING SUM(TXNAMT*DECODE(RVSLBL,'*',-1,1))!=0 ) )
            ORDER BY VCHSET,SETSEQ DESC) A, ACTOAC B, ACTANI C
       WHERE
                B.ORGIDT = A.ORGIDT
            AND B.CUSIDT = A.CUSIDT
            AND B.APCODE = A.APCODE
            AND B.CURCDE = A.CURCDE
            AND C.SYSIDT = #{sysidt}
            AND C.ORGIDT = A.ORGIDT
            AND C.CUSIDT = A.CUSIDT
            AND C.APCODE = A.APCODE
            AND C.CURCDE = A.CURCDE

        ]]>
    </select>

    <select id="selectMultiVchsetRecordsForNoDCBalChk" resultMap="ViewResultMap">
        <![CDATA[

        SELECT  A.VCHSET,A.SETSEQ,
                A.CUSIDT, A.APCODE, A.CURCDE,
                C.OLDACN AS ACTNO,
                A.RVSLBL AS TYPE,
                A.TXNAMT,
                A.VALDAT,A.ANACDE,A.FURINF,A.VCHATT,A.VCHSTS,A.RECSTS,
                B.ACTNAM
        FROM
           (SELECT ORGIDT, TLRNUM, VCHSET, SETSEQ,
                   CUSIDT, APCODE, CURCDE, PRDCDE,
                   TXNAMT, VALDAT, RVSLBL, ANACDE,
                   FURINF, FXRATE, SECCCY, SECAMT,
                   CORAPC, VCHATT, VCHAUT, DEPNUM,
                   TXNBAK, ACTBAK, CLRBAK, ERYDAT,
                   ERYTIM, OUFCRE, VCHSTS, FXEFLG,
                   RECSTS, ERYTYP
             FROM ACTTVC
            WHERE ORGIDT=#{orgidt}
              AND TLRNUM=#{tlrnum}
              AND ( VCHSET IN ( SELECT DISTINCT VCHSET
                                  FROM ACTTVC
                                 WHERE ORGIDT=#{orgidt}
                                   AND TLRNUM=#{tlrnum}
                                   AND RECSTS=' '
                                   AND VCHSTS='1' ))
            ORDER BY VCHSET,SETSEQ DESC) A, ACTOAC B, ACTANI C
       WHERE
                B.ORGIDT = A.ORGIDT
            AND B.CUSIDT = A.CUSIDT
            AND B.APCODE = A.APCODE
            AND B.CURCDE = A.CURCDE
            AND C.SYSIDT = #{sysidt}
            AND C.ORGIDT = A.ORGIDT
            AND C.CUSIDT = A.CUSIDT
            AND C.APCODE = A.APCODE
            AND C.CURCDE = A.CURCDE

        ]]>
    </select>

    <select id="selectOneVchsetRecords" resultMap="ViewResultMap">
        <![CDATA[

        SELECT  A.VCHSET,A.SETSEQ,
                A.CUSIDT, A.APCODE, A.CURCDE,
                C.OLDACN AS ACTNO,
                A.RVSLBL AS TYPE,
                A.TXNAMT,
                A.VALDAT,A.ANACDE,A.FURINF,A.VCHATT,A.VCHSTS,A.RECSTS,
                B.ACTNAM
        FROM
           (SELECT ORGIDT, TLRNUM, VCHSET, SETSEQ,
                   CUSIDT, APCODE, CURCDE, PRDCDE,
                   TXNAMT, VALDAT, RVSLBL, ANACDE,
                   FURINF, FXRATE, SECCCY, SECAMT,
                   CORAPC, VCHATT, VCHAUT, DEPNUM,
                   TXNBAK, ACTBAK, CLRBAK, ERYDAT,
                   ERYTIM, OUFCRE, VCHSTS, FXEFLG,
                   RECSTS, ERYTYP
             FROM ACTTVC
            WHERE ORGIDT=#{orgidt}
              AND TLRNUM=#{tlrnum}
              AND VCHSET=#{vchset}
            ORDER BY VCHSET,SETSEQ DESC) A, ACTOAC B, ACTANI C
       WHERE
                B.ORGIDT = A.ORGIDT
            AND B.CUSIDT = A.CUSIDT
            AND B.APCODE = A.APCODE
            AND B.CURCDE = A.CURCDE
            AND C.SYSIDT = #{sysidt}
            AND C.ORGIDT = A.ORGIDT
            AND C.CUSIDT = A.CUSIDT
            AND C.APCODE = A.APCODE
            AND C.CURCDE = A.CURCDE

        ]]>
    </select>


</mapper>